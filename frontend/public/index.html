<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MatrimonyAI - AI-Powered Matchmaking Platform</title>
    <meta name="description" content="Find your perfect life partner with AI-powered matchmaking">
    
    <!-- Parse SDK -->
    <script src="https://npmcdn.com/parse@3.4.4/dist/parse.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Standalone for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        #root {
            min-height: 100vh;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Initialize Parse
        Parse.initialize(
            "CbVGxOMxBWjB9PX56jNvJwJI3IxLelLYMZEP3zkH", // Application ID
            "JwT7c97VJ7VuvmYwsobZUDHwoFLIRghWygDNV5Iy"  // JavaScript Key
        );
        Parse.serverURL = 'https://parseapi.back4app.com';

        // Lucide Icons
        const { 
            MessageSquare, Heart, User, Search, Star, 
            CheckCircle, Send, Menu, X, Video, Shield, Crown 
        } = lucide;

        const MatrimonyApp = () => {
            const [currentView, setCurrentView] = useState('home');
            const [showMobileMenu, setShowMobileMenu] = useState(false);
            const [profiles, setProfiles] = useState([]);
            const [currentUser, setCurrentUser] = useState(null);
            const [chatMessages, setChatMessages] = useState([]);
            const [chatInput, setChatInput] = useState('');
            const [loading, setLoading] = useState(false);
            const chatEndRef = useRef(null);

            useEffect(() => {
                initializeDemoData();
                checkCurrentUser();
            }, []);

            const checkCurrentUser = async () => {
                const user = Parse.User.current();
                if (user) {
                    setCurrentUser({
                        id: user.id,
                        name: user.get('username'),
                        email: user.get('email')
                    });
                }
            };

            const initializeDemoData = () => {
                setProfiles([
                    {
                        id: 'p1',
                        name: 'Priya Sharma',
                        age: 26,
                        height: '5\'5"',
                        occupation: 'Doctor',
                        city: 'Mumbai',
                        religion: 'Hindu',
                        education: 'MBBS',
                        photo: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=400',
                        compatibilityScore: 95,
                        verified: true,
                        matchReasons: ['Similar values', 'Compatible profession', 'Family oriented']
                    },
                    {
                        id: 'p2',
                        name: 'Ananya Iyer',
                        age: 27,
                        height: '5\'4"',
                        occupation: 'Teacher',
                        city: 'Bangalore',
                        religion: 'Hindu',
                        education: 'M.Ed',
                        photo: 'https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=400',
                        compatibilityScore: 92,
                        verified: true,
                        matchReasons: ['Shared interests', 'Similar background', 'Values education']
                    },
                    {
                        id: 'p3',
                        name: 'Meera Reddy',
                        age: 25,
                        height: '5\'6"',
                        occupation: 'Marketing Manager',
                        city: 'Hyderabad',
                        religion: 'Hindu',
                        education: 'MBA',
                        photo: 'https://images.unsplash.com/photo-1524504388940-b1c1722653e1?w=400',
                        compatibilityScore: 89,
                        verified: true,
                        matchReasons: ['Career oriented', 'Similar age', 'Modern outlook']
                    }
                ]);

                setChatMessages([{
                    role: 'assistant',
                    content: "Hi! ðŸ‘‹ I'm your AI matchmaker powered by Llama 3.2. I'll help you find your perfect life partner by understanding your preferences through conversation. Tell me about yourself and what you're looking for!",
                    timestamp: new Date()
                }]);
            };

            const sendMessage = async () => {
                if (!chatInput.trim()) return;

                const userMessage = chatInput;
                setChatInput('');
                
                const newMessages = [...chatMessages, {
                    role: 'user',
                    content: userMessage,
                    timestamp: new Date()
                }];
                setChatMessages(newMessages);
                setLoading(true);

                try {
                    // Call Back4App Cloud Function with Groq/Llama
                    const result = await Parse.Cloud.run("aiChat", {
                        userId: currentUser?.id || "demo",
                        message: userMessage,
                        sessionId: "session_" + Date.now()
                    });

                    if (result.success) {
                        setChatMessages([...newMessages, {
                            role: 'assistant',
                            content: result.message,
                            timestamp: new Date()
                        }]);
                    } else {
                        // Fallback demo response
                        const demoResponses = [
                            "That's wonderful! Based on what you've shared, I can see you value family and career. Would you prefer someone with a similar professional background?",
                            "I understand. Let me ask - what qualities are most important to you in a life partner?",
                            "Great! I'm learning about your preferences. Tell me more about your ideal partner's personality traits.",
                            "Excellent! Based on our conversation, I've identified some profiles that match your preferences. Would you like to see them?",
                            "That's very helpful! I'm updating your preferences. Do you have any location preferences or are you open to relocation?"
                        ];
                        
                        const randomResponse = demoResponses[Math.floor(Math.random() * demoResponses.length)];
                        
                        setChatMessages([...newMessages, {
                            role: 'assistant',
                            content: randomResponse,
                            timestamp: new Date()
                        }]);
                    }
                } catch (error) {
                    console.error("Chat error:", error);
                    setChatMessages([...newMessages, {
                        role: 'assistant',
                        content: "I'm having trouble connecting right now. Please try again in a moment.",
                        timestamp: new Date()
                    }]);
                }
                
                setLoading(false);
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            };

            useEffect(() => {
                chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            }, [chatMessages]);

            const ProfileCard = ({ profile }) => (
                <div className="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1">
                    <div className="relative">
                        <img 
                            src={profile.photo} 
                            alt={profile.name}
                            className="w-full h-64 object-cover"
                        />
                        <div className="absolute top-3 right-3 bg-white px-3 py-1 rounded-full shadow-lg flex items-center gap-1">
                            <Star className="w-4 h-4 text-yellow-500 fill-yellow-500" />
                            <span className="font-semibold text-sm">{profile.compatibilityScore}%</span>
                        </div>
                        {profile.verified && (
                            <div className="absolute top-3 left-3 bg-blue-500 px-3 py-1 rounded-full shadow-lg flex items-center gap-1">
                                <CheckCircle className="w-4 h-4 text-white" />
                                <span className="text-white text-xs font-semibold">Verified</span>
                            </div>
                        )}
                    </div>
                    <div className="p-5">
                        <div className="flex justify-between items-start mb-3">
                            <div>
                                <h3 className="text-xl font-bold text-gray-800">{profile.name}</h3>
                                <p className="text-gray-600">{profile.age} years, {profile.height}</p>
                            </div>
                            <button className="text-red-500 hover:scale-110 transition-transform">
                                <Heart className="w-6 h-6" />
                            </button>
                        </div>
                        
                        <div className="space-y-2 mb-4">
                            <p className="text-gray-700"><span className="font-semibold">Occupation:</span> {profile.occupation}</p>
                            <p className="text-gray-700"><span className="font-semibold">Education:</span> {profile.education}</p>
                            <p className="text-gray-700"><span className="font-semibold">Location:</span> {profile.city}</p>
                            <p className="text-gray-700"><span className="font-semibold">Religion:</span> {profile.religion}</p>
                        </div>

                        <div className="mb-4">
                            <p className="text-sm font-semibold text-gray-800 mb-2">Why this match?</p>
                            <div className="flex flex-wrap gap-2">
                                {profile.matchReasons.map((reason, idx) => (
                                    <span key={idx} className="bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-xs">
                                        {reason}
                                    </span>
                                ))}
                            </div>
                        </div>

                        <div className="flex gap-2">
                            <button className="flex-1 bg-gradient-to-r from-pink-500 to-red-500 text-white py-2 rounded-lg hover:shadow-lg transition-all font-semibold">
                                View Profile
                            </button>
                            <button className="px-4 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                                <MessageSquare className="w-5 h-5 text-gray-700" />
                            </button>
                        </div>
                    </div>
                </div>
            );

            const AIChat = () => (
                <div className="flex flex-col h-full">
                    <div className="bg-gradient-to-r from-purple-600 to-pink-600 text-white p-4 rounded-t-xl">
                        <h2 className="text-xl font-bold flex items-center gap-2">
                            <MessageSquare className="w-6 h-6" />
                            AI Matchmaker Chat
                        </h2>
                        <p className="text-sm opacity-90 mt-1">Powered by Llama 3.2 via Groq</p>
                    </div>
                    
                    <div className="flex-1 overflow-y-auto p-4 bg-gray-50 space-y-4">
                        {chatMessages.map((msg, idx) => (
                            <div key={idx} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                <div className={`max-w-[80%] rounded-2xl px-4 py-3 ${
                                    msg.role === 'user' 
                                        ? 'bg-gradient-to-r from-blue-500 to-purple-500 text-white' 
                                        : 'bg-white shadow-md text-gray-800'
                                }`}>
                                    <p className="text-sm leading-relaxed">{msg.content}</p>
                                    <p className="text-xs mt-1 opacity-70">
                                        {msg.timestamp.toLocaleTimeString()}
                                    </p>
                                </div>
                            </div>
                        ))}
                        {loading && (
                            <div className="flex justify-start">
                                <div className="bg-white shadow-md rounded-2xl px-4 py-3">
                                    <div className="flex gap-2">
                                        <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                                        <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{animationDelay: '0.1s'}}></div>
                                        <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{animationDelay: '0.2s'}}></div>
                                    </div>
                                </div>
                            </div>
                        )}
                        <div ref={chatEndRef} />
                    </div>

                    <div className="p-4 bg-white border-t">
                        <div className="flex gap-2">
                            <input
                                type="text"
                                value={chatInput}
                                onChange={(e) => setChatInput(e.target.value)}
                                onKeyPress={handleKeyPress}
                                placeholder="Type your message..."
                                className="flex-1 px-4 py-3 border border-gray-300 rounded-full focus:outline-none focus:border-purple-500"
                            />
                            <button
                                onClick={sendMessage}
                                disabled={!chatInput.trim() || loading}
                                className="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-3 rounded-full hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                <Send className="w-5 h-5" />
                            </button>
                        </div>
                    </div>
                </div>
            );

            const HomeView = () => (
                <div>
                    <div className="bg-gradient-to-r from-pink-500 via-purple-500 to-indigo-500 text-white rounded-2xl p-8 mb-8 shadow-xl">
                        <h1 className="text-4xl font-bold mb-4">Welcome to Your Perfect Match Journey! ðŸ’‘</h1>
                        <p className="text-lg mb-6">AI-powered matchmaking that truly understands you</p>
                        <div className="flex gap-4">
                            <button 
                                onClick={() => setCurrentView('chat')}
                                className="bg-white text-purple-600 px-6 py-3 rounded-lg font-semibold hover:shadow-xl transition-all"
                            >
                                Start AI Chat
                            </button>
                            <button className="bg-white/20 backdrop-blur text-white px-6 py-3 rounded-lg font-semibold hover:bg-white/30 transition-all">
                                Browse Profiles
                            </button>
                        </div>
                    </div>

                    <div className="mb-6">
                        <h2 className="text-2xl font-bold text-gray-800 mb-4">Your Top Matches</h2>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {profiles.map(profile => (
                                <ProfileCard key={profile.id} profile={profile} />
                            ))}
                        </div>
                    </div>

                    <div className="bg-white rounded-xl shadow-lg p-6">
                        <h3 className="text-xl font-bold text-gray-800 mb-4">Platform Features</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div className="p-4 bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg">
                                <MessageSquare className="w-8 h-8 text-blue-600 mb-2" />
                                <h4 className="font-semibold text-gray-800 mb-1">AI Matchmaker</h4>
                                <p className="text-sm text-gray-600">Chat with AI to find perfect matches</p>
                            </div>
                            <div className="p-4 bg-gradient-to-br from-green-50 to-green-100 rounded-lg">
                                <Shield className="w-8 h-8 text-green-600 mb-2" />
                                <h4 className="font-semibold text-gray-800 mb-1">Verified Profiles</h4>
                                <p className="text-sm text-gray-600">AI-powered verification system</p>
                            </div>
                            <div className="p-4 bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg">
                                <Video className="w-8 h-8 text-purple-600 mb-2" />
                                <h4 className="font-semibold text-gray-800 mb-1">Video Profiles</h4>
                                <p className="text-sm text-gray-600">See real video introductions</p>
                            </div>
                            <div className="p-4 bg-gradient-to-br from-pink-50 to-pink-100 rounded-lg">
                                <Crown className="w-8 h-8 text-pink-600 mb-2" />
                                <h4 className="font-semibold text-gray-800 mb-1">Premium Matching</h4>
                                <p className="text-sm text-gray-600">Advanced AI compatibility scoring</p>
                            </div>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50">
                    <header className="bg-white shadow-md sticky top-0 z-50">
                        <div className="max-w-7xl mx-auto px-4 py-4">
                            <div className="flex justify-between items-center">
                                <div className="flex items-center gap-2">
                                    <Heart className="w-8 h-8 text-pink-500 fill-pink-500" />
                                    <h1 className="text-2xl font-bold bg-gradient-to-r from-pink-500 to-purple-600 bg-clip-text text-transparent">
                                        MatrimonyAI
                                    </h1>
                                </div>

                                <nav className="hidden md:flex items-center gap-6">
                                    <button 
                                        onClick={() => setCurrentView('home')}
                                        className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-all ${
                                            currentView === 'home' ? 'bg-purple-100 text-purple-600' : 'text-gray-600 hover:bg-gray-100'
                                        }`}
                                    >
                                        <Search className="w-5 h-5" />
                                        <span className="font-semibold">Discover</span>
                                    </button>
                                    <button 
                                        onClick={() => setCurrentView('chat')}
                                        className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-all ${
                                            currentView === 'chat' ? 'bg-purple-100 text-purple-600' : 'text-gray-600 hover:bg-gray-100'
                                        }`}
                                    >
                                        <MessageSquare className="w-5 h-5" />
                                        <span className="font-semibold">AI Chat</span>
                                    </button>
                                    <button className="flex items-center gap-2 px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-100 transition-all">
                                        <Heart className="w-5 h-5" />
                                        <span className="font-semibold">Matches</span>
                                    </button>
                                    <button className="flex items-center gap-2 px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-100 transition-all">
                                        <User className="w-5 h-5" />
                                        <span className="font-semibold">Profile</span>
                                    </button>
                                </nav>

                                <button 
                                    className="md:hidden"
                                    onClick={() => setShowMobileMenu(!showMobileMenu)}
                                >
                                    {showMobileMenu ? <X className="w-6 h-6" /> : <Menu className="w-6 h-6" />}
                                </button>
                            </div>

                            {showMobileMenu && (
                                <nav className="md:hidden mt-4 pb-4 space-y-2">
                                    <button 
                                        onClick={() => { setCurrentView('home'); setShowMobileMenu(false); }}
                                        className="w-full flex items-center gap-2 px-4 py-3 rounded-lg bg-gray-50 hover:bg-gray-100"
                                    >
                                        <Search className="w-5 h-5" />
                                        <span>Discover</span>
                                    </button>
                                    <button 
                                        onClick={() => { setCurrentView('chat'); setShowMobileMenu(false); }}
                                        className="w-full flex items-center gap-2 px-4 py-3 rounded-lg bg-gray-50 hover:bg-gray-100"
                                    >
                                        <MessageSquare className="w-5 h-5" />
                                        <span>AI Chat</span>
                                    </button>
                                </nav>
                            )}
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto px-4 py-8">
                        {currentView === 'home' && <HomeView />}
                        {currentView === 'chat' && (
                            <div className="bg-white rounded-xl shadow-2xl overflow-hidden" style={{height: '600px'}}>
                                <AIChat />
                            </div>
                        )}
                    </main>

                    <footer className="bg-white mt-16 py-8 border-t">
                        <div className="max-w-7xl mx-auto px-4 text-center text-gray-600">
                            <p className="mb-2">Â© 2025 MatrimonyAI - Powered by Back4App & Groq/Llama 3.2</p>
                            <p className="text-sm">AI-powered matchmaking for your perfect life partner ðŸ’•</p>
                        </div>
                    </footer>
                </div>
            );
        };

        // Initialize Lucide icons
        lucide.createIcons();

        // Render app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MatrimonyApp />);
    </script>
</body>
</html>
